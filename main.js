(()=>{"use strict";class t{constructor(){this.board=Array.from({length:100},((t,e)=>({x:e%10,y:Math.floor(e/10),hit:!1,occupied:!1,ship:null})))}placeShip(t,e,r,s){let i=[];if("horizontal"===s){if(t+r.length>10)return!1;for(let s=0;s<r.length;s++){const r=this.board[10*e+t+s];i.push(r)}}else{if(e+r.length>10)return!1;for(let s=0;s<r.length;s++){const r=this.board[10*(e+s)+t];i.push(r)}}if(i.some((t=>t.occupied)))return!1;for(const t of i){const e=this.getAllAdjacentCells(t.x,t.y);for(const t of e)if(t.occupied)return!1}return i.forEach((t=>{t.occupied=!0,t.ship=r})),!0}receiveAttack(t,e){const r=this.board[10*e+t];return!r.hit&&(r.occupied&&r.ship.hit(),r.hit=!0,!0)}areAllShipsSunk(){return 0===this.board.filter((t=>!0===t.occupied&&!1===t.hit)).length}resetBoard(){this.board.forEach((t=>{t.hit=!1,t.occupied=!1,t.ship=null}))}getAllAdjacentCells(t,e){const r=[],s=[-1,0,1];for(const i of s)for(const a of s){if(0===i&&0===a)continue;const s=t+i,o=e+a;if(s>=0&&s<10&&o>=0&&o<10){const t=this.board[10*o+s];r.push(t)}}return r}}class e{constructor(t){this.length=t,this.damage=0,this.sunk=!1}hit(){this.damage++}isSunk(){return this.length===this.damage&&(this.sunk=!0,!0)}}class r{constructor(){this.gameBoard=new t,this.fleet=[new e(5),new e(4),new e(3),new e(3),new e(2)]}attack(t,e,r){return!!r.receiveAttack(t,e)&&(r.receiveAttack(t,e),!0)}aiAttack(t){let e,r,s;do{e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),s=t.receiveAttack(e,r)}while(!s);console.log(e,r)}aiPlacement(){this.fleet.forEach((t=>{let e=!1;for(;!e;){const r=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),i=Math.random()<.5?"horizontal":"vertical";e=this.gameBoard.placeShip(r,s,t,i)}}))}}(new class{constructor(){this.humanPlayer=new r,this.computerPlayer=new r,this.userBoardDOM=document.querySelector(".user-board"),this.enemyBoardDOM=document.querySelector(".enemy-board"),this.rotateButton=document.querySelector(".rotate-btn"),this.startButton=document.querySelector(".start-btn"),this.restartButton=document.querySelector(".restart-btn"),this.resultDisplay=document.querySelector(".result"),this.isUserTurn=!0,this.currentShipIndex=0,this.currentDirection="horizontal"}initializeGame(){this.renderUserBoard(),this.renderEnemyBoard(),this.computerPlayer.aiPlacement(),this.handleShipRotation(),this.placeShips(),this.startButton.addEventListener("click",(()=>{this.startButton.classList.add("hidden"),this.gamePlay()})),this.restartButton.addEventListener("click",(()=>{this.resetGame(),this.initializeGame()}))}placeShips(){if(this.currentShipIndex>=this.humanPlayer.fleet.length)return this.rotateButton.classList.add("hidden"),void this.startButton.classList.remove("hidden");const t=this.userBoardDOM;this.userBoardDOM=t.cloneNode(!0),t.parentNode.replaceChild(this.userBoardDOM,t);const e=this.userBoardDOM.querySelectorAll(".cell"),r=this.humanPlayer.fleet[this.currentShipIndex];for(let t=0;t<e.length;t++)"horizontal"===this.currentDirection&&t%10+r.length>10||"vertical"===this.currentDirection&&t+10*(r.length-1)>=e.length||(e[t].addEventListener("mouseover",(()=>{for(let s=0;s<r.length;s++)"horizontal"===this.currentDirection?e[t+s].classList.add("ship-preview"):e[t+10*s].classList.add("ship-preview")})),e[t].addEventListener("mouseout",(()=>{for(let s=0;s<r.length;s++)"horizontal"===this.currentDirection?e[t+s].classList.remove("ship-preview"):e[t+10*s].classList.remove("ship-preview")})),e[t].addEventListener("click",(()=>{const e=t%10,s=Math.floor(t/10);this.humanPlayer.gameBoard.placeShip(e,s,r,this.currentDirection)&&(this.renderUserBoard(),this.currentShipIndex++,this.placeShips())})))}gamePlay(){if(this.isUserTurn)this.enemyBoardDOM.querySelectorAll(".cell").forEach((t=>{t.classList.contains("hit")||t.addEventListener("click",(t=>{const e=t.target,r=parseInt(e.id.slice(1)),s=r%10,i=Math.floor(r/10);if(e.classList.contains("hit")||this.humanPlayer.attack(s,i,this.computerPlayer.gameBoard),this.renderEnemyBoard(),this.computerPlayer.gameBoard.areAllShipsSunk())return this.restartButton.classList.remove("hidden"),this.resultDisplay.textContent="You win!",void this.resultDisplay.classList.remove("hidden");this.isUserTurn=!1,setTimeout((()=>{this.gamePlay()}),500)}))}),{once:!0});else{if(this.computerPlayer.aiAttack(this.humanPlayer.gameBoard),this.renderUserBoard(),this.humanPlayer.gameBoard.areAllShipsSunk())return this.restartButton.classList.remove("hidden"),this.resultDisplay.textContent="Computer wins!",void this.resultDisplay.classList.remove("hidden");this.isUserTurn=!0,this.gamePlay()}}renderUserBoard(){this.userBoardDOM.innerHTML="";const t=this.humanPlayer.gameBoard.board;let e=0;t.forEach((t=>{const r=document.createElement("div");r.classList.add("cell"),t.hit&&r.classList.add("hit"),t.occupied&&r.classList.add("occupied"),r.setAttribute("id",`u${e}`),e++,this.userBoardDOM.appendChild(r)}))}renderEnemyBoard(){this.enemyBoardDOM.innerHTML="";const t=this.computerPlayer.gameBoard.board;let e=0;t.forEach((t=>{const r=document.createElement("div");r.classList.add("cell"),t.hit&&r.classList.add("hit"),t.occupied&&r.classList.add("occupied"),r.setAttribute("id",`e${e}`),e++,this.enemyBoardDOM.appendChild(r)}))}handleShipRotation(){this.rotateButton.addEventListener("click",(()=>{this.currentDirection="horizontal"===this.currentDirection?"vertical":"horizontal",this.placeShips()}))}resetGame(){this.humanPlayer.gameBoard.resetBoard(),this.computerPlayer.gameBoard.resetBoard();const t=this.startButton.cloneNode(!0),e=this.restartButton.cloneNode(!0),r=this.rotateButton.cloneNode(!0);this.startButton.parentNode.replaceChild(t,this.startButton),this.restartButton.parentNode.replaceChild(e,this.restartButton),this.rotateButton.parentNode.replaceChild(r,this.rotateButton),this.startButton=t,this.restartButton=e,this.rotateButton=r,this.startButton.classList.add("hidden"),this.restartButton.classList.add("hidden"),this.rotateButton.classList.remove("hidden"),this.resultDisplay.classList.add("hidden"),this.isUserTurn=!0,this.currentShipIndex=0,this.currentDirection="horizontal"}}).initializeGame()})();